# Test: Simplified Strawberry GraphQL Types Generation
# Eliminates intermediate extraction steps by using glob directly

version: light

nodes:
  - label: Start
    type: start
    position: {x: 50, y: 300}
    props:
      custom_data:
        message: Testing simplified Strawberry types generation

  # Run batch parser if cache doesn't exist
  - label: Parse TypeScript Batch
    type: sub_diagram
    position: {x: 200, y: 300}
    props:
      diagram_name: projects/codegen/diagrams/shared/parse_typescript_batch_direct
      diagram_format: light
      passInputData: false
      ignoreIfSub: true

  # Load all spec files using glob
  - label: Load All Spec Files
    type: db
    position: {x: 350, y: 300}
    props:
      operation: read
      sub_type: file
      format: json
      glob: true
      source_details:
        - "temp/specifications/nodes/*.spec.ts.json"

  # SIMPLIFIED: Direct generation from glob results
  - label: Generate Strawberry Types Direct
    type: code_job
    position: {x: 550, y: 300}
    props:
      language: python
      filePath: projects/codegen/code/shared/simplified_extractors.py
      functionName: prepare_strawberry_types

  # Use template_job for rendering
  - label: Render Types Template
    type: template_job
    position: {x: 750, y: 300}
    props:
      engine: jinja2
      template_path: projects/codegen/templates/models/strawberry_types.j2
      output_path: dipeo/diagram_generated_staged/graphql/strawberry_nodes_test.py
      variables:
        module_name: "strawberry_nodes_test"
        generated_warning: "DO NOT EDIT - Generated by DiPeO (Simplified)"

  - label: End
    type: endpoint
    position: {x: 950, y: 300}
    props:
      save_to_file: false

connections:
  # Parse specs first
  - {from: Start, to: Parse TypeScript Batch}
  
  # Load spec files
  - {from: Parse TypeScript Batch, to: Load All Spec Files}
  
  # DIRECT CONNECTION: glob results â†’ strawberry types generation
  - {from: Load All Spec Files, to: Generate Strawberry Types Direct, content_type: object}
  
  # Pass strawberry types to template renderer
  - {from: Generate Strawberry Types Direct, to: Render Types Template, label: strawberry_types, content_type: object}
  
  - {from: Render Types Template, to: End}