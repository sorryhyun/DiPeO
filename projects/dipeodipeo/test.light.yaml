version: light

name: llm_diagram_generator
description: Generate DiPeO light diagrams using LLM with structured Pydantic output

persons:
  diagram_designer:
    service: openai
    model: gpt-5-nano-2025-08-07
    api_key_id: APIKEY_52609F
    system_prompt: |
      You are an expert DiPeO diagram designer. You create well-structured light format diagrams
      that follow best practices for modularity, error handling, and performance.
      Always ensure proper node positioning with x-coordinates incrementing by 200-300 for readability.

nodes:
  - label: start
    type: start
    position: {x: 100, y: 200}
    
  - label: load_request
    type: db
    position: {x: 300, y: 200}
    props:
      operation: read
      sub_type: file
      source_details: projects/dipeodipeo/request.txt
      format: text

  - label: generate_diagram
    type: person_job
    position: {x: 600, y: 200}
    props:
      person: diagram_designer
      prompt_file: diagram_generator.txt
      max_iteration: 1
      text_format_file: projects/dipeodipeo/light_diagram_models.py
      
  - label: format_yaml
    type: code_job
    position: {x: 700, y: 200}
    props:
      language: python
      filePath: projects/dipeodipeo/process.py
      functionName: process_diagram
  
  - label: save_diagram
    type: db
    position: {x: 1000, y: 200}
    props:
      operation: write
      sub_type: file
      format: yaml
      source_details: projects/dipeodipeo/generated/diagram.light.yaml


connections:
  - {from: start, to: load_request}
  - {from: load_request, to: generate_diagram, label: workflow_description}
  - {from: generate_diagram, to: format_yaml, label: generated_diagram, content_type: object}
  - {from: format_yaml, to: save_diagram, label: diagram_output, content_type: object}