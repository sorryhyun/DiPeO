version: light

name: ollama_debate_example
description: Local debate powered by Ollama personas with a detecting loop guard.

persons:
  Judge:
    service: ollama
    model: llama3.2:1b
    api_key_id: APIKEY_DUMMY  # Ollama runners ignore this value
    system_prompt: |
      You are an impartial moderator. Summarize the winning side in under 25 words.

  Optimist:
    service: ollama
    model: llama3.2:1b
    api_key_id: APIKEY_DUMMY
    system_prompt: |
      You argue with enthusiasm and highlight positive opportunities. Stay under 25 words.

  Pessimist:
    service: ollama
    model: llama3.2:1b
    api_key_id: APIKEY_DUMMY
    system_prompt: |
      You argue with skepticism and focus on risks. Stay under 25 words.

nodes:
  - label: Start
    type: start
    position: {x: 177, y: 320}
    props:
      trigger_mode: manual

  - label: Load Topic
    type: db
    position: {x: 431, y: 148}
    props:
      operation: read
      sub_type: file
      source_details: files/uploads/questions.txt

  - label: Optimist
    type: person_job
    position: {x: 600, y: 452}
    props:
      person: Optimist
      first_only_prompt: "Suggest a reasonable argument: {{topic}}"
      default_prompt: Argue against the argument.
      max_iteration: 2
      memorize_to: GOLDFISH
      flipped: [false, true]

  - label: Pessimist
    type: person_job
    position: {x: 899, y: 380}
    props:
      person: Pessimist
      first_only_prompt: "Suggest a reasonable argument: {{topic}}"
      default_prompt: Argue against the argument.
      max_iteration: 3
      memorize_to: GOLDFISH
      flipped: [false, true]

  - label: Judge Panel
    type: person_job
    position: {x: 439, y: 663}
    props:
      person: Judge
      default_prompt: Judge which panel is more reasonable.
      max_iteration: 1
      memorize_to: ALL_MESSAGES
      flipped: [true, false]

  - label: Detect Max Iterations
    type: condition
    position: {x: 785, y: 647}
    props:
      condition_type: detect_max_iterations
      flipped: [true, true]

  - label: Save Verdict
    type: endpoint
    position: {x: 58, y: 668}
    props:
      save_to_file: true
      file_format: txt
      file_path: files/results/output.txt
      flipped: [true, false]

connections:
  - {from: Start, to: Load Topic}
  - {from: Load Topic, to: Optimist_first, content_type: raw_text, label: topic}
  - {from: Load Topic, to: Pessimist_first, content_type: raw_text, label: topic}
  - {from: Optimist, to: Pessimist, content_type: conversation_state}
  - {from: Pessimist, to: Detect Max Iterations, content_type: conversation_state}
  - {from: Detect Max Iterations_condfalse, to: Optimist, content_type: conversation_state}
  - {from: Detect Max Iterations_condtrue, to: Judge Panel, content_type: conversation_state}
  - {from: Judge Panel, to: Save Verdict, content_type: raw_text}
