# Example: Web Scraping with MCP Browser Tools
# This diagram demonstrates using MCP browser tools through integrated_api nodes

version: light

persons:
  Content Analyzer:
    service: openai
    model: gpt-5-nano-2025-08-07
    system_prompt: You are an expert at analyzing web content and extracting key information.

nodes:
  - label: Start
    type: start
    position: {x: 50, y: 200}
    props:
      trigger_mode: manual
      custom_data:
        target_url: "https://example.com"
        selectors:
          title: "h1"
          content: ".main-content"
          links: "a[href]"

  # Navigate to the target website
  - label: Navigate to Website
    type: integrated_api
    position: {x: 250, y: 200}
    props:
      provider: mcp_browser
      operation: browser_navigate
      config:
        url: "{{target_url}}"
        wait_until: "networkidle"

  # Take a snapshot of the page
  - label: Capture Page Snapshot
    type: integrated_api
    position: {x: 450, y: 200}
    props:
      provider: mcp_browser
      operation: browser_snapshot
      config:
        include_html: true
        include_screenshot: false

  # Analyze the page content
  - label: Analyze Content
    type: person_job
    position: {x: 650, y: 200}
    props:
      person: Content Analyzer
      default_prompt: |
        Analyze this webpage snapshot and extract:
        1. Main topic/purpose of the page
        2. Key information or data points
        3. Important links or resources
        4. Overall structure and organization
        
        Page data:
        URL: {{navigation_result.url}}
        Title: {{navigation_result.title}}
        HTML Content: {{snapshot.html}}
      max_iteration: 1
      memory_profile: MINIMAL

  # Save the analysis results
  - label: Save Analysis
    type: integrated_api
    position: {x: 850, y: 200}
    props:
      provider: mcp_filesystem
      operation: file_write
      config:
        path: "files/results/web_analysis.json"
        content: "{{analysis_result}}"
        mode: "overwrite"
        create_dirs: true

  - label: Complete
    type: endpoint
    position: {x: 1050, y: 200}
    props:
      file_format: json
      save_to_file: true
      file_path: files/results/scraping_summary.json

connections:
  - from: Start
    to: Navigate to Website
    content_type: raw_text
    
  - from: Navigate to Website
    to: Capture Page Snapshot
    content_type: raw_text
    label: navigation_result
    
  - from: Capture Page Snapshot
    to: Analyze Content
    content_type: raw_text
    label: snapshot
    
  - from: Analyze Content
    to: Save Analysis
    content_type: raw_text
    label: analysis_result
    
  - from: Save Analysis
    to: Complete
    content_type: raw_text