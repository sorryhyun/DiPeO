#!/usr/bin/env python3
"""
Generated by DiPeO Diagram-to-Python Exporter
This is a standalone Python script that can be run without DiPeO.

To run: python <script>.py
"""

import asyncio
import os
from pathlib import Path

from openai import AsyncOpenAI


async def main():
    """Main execution function."""

    # Initialize clients
    openai_client = AsyncOpenAI(api_key=os.environ.get("OPENAI_API_KEY"))

    # start
    print("Starting execution...")

    # Loop: max 3 iterations
    iteration_count = 0
    while iteration_count < 3:
        # printer
        response = await openai_client.chat.completions.create(
            model="gpt-5-nano-2025-08-07", messages=[{"role": "user", "content": "say hi"}]
        )
        printer_output = response.choices[0].message.content

        iteration_count += 1

    # ask
    response = await openai_client.chat.completions.create(
        model="gpt-5-nano-2025-08-07",
        messages=[{"role": "user", "content": "How many times did you respond?"}],
    )
    ask_output = response.choices[0].message.content

    # endpoint
    # Save result to file
    output_path = Path("files/results/total.txt")
    output_path.parent.mkdir(parents=True, exist_ok=True)
    output_path.write_text(str(ask_output))
    print(f"✅ Saved output to {output_path}")

    print("✅ Execution complete")


if __name__ == "__main__":
    asyncio.run(main())
