# Test diagram for memory selection with Claude Code adapter
id: test_memory_selection
label: Memory Selection Test
description: Test that selected messages are preserved as individual conversation turns

nodes:
  start:
    type: Start
    outputs:
      - default
    position: { x: 0, y: 0 }

  first_message:
    type: PersonJob
    person: assistant
    service_name: claude-code
    default_prompt: "Hello! I'm going to help you test memory selection."
    outputs:
      - default
    position: { x: 200, y: 0 }

  second_message:
    type: PersonJob
    person: assistant
    service_name: claude-code
    default_prompt: "This is the second message in our conversation."
    outputs:
      - default
    position: { x: 400, y: 0 }

  third_message:
    type: PersonJob
    person: assistant
    service_name: claude-code
    default_prompt: "This is the third message. Now we'll test memory selection."
    outputs:
      - default
    position: { x: 600, y: 0 }

  memory_test:
    type: PersonJob
    person: assistant
    service_name: claude-code
    memorize_to: "recent"  # Select recent messages
    at_most: 2  # Select at most 2 messages
    default_prompt: "Based on our previous conversation, how many messages have I sent you?"
    outputs:
      - default
    position: { x: 800, y: 0 }

edges:
  - from: start.default
    to: first_message.default
  - from: first_message.default
    to: second_message.default
  - from: second_message.default
    to: third_message.default
  - from: third_message.default
    to: memory_test.default
