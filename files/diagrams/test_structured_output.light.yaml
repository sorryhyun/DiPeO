diagram:
  label: Test Structured Output
  description: Test that PersonJob nodes work with OpenAI structured output using JsonValue types

persons:
  assistant:
    name: Assistant
    model: gpt-5-nano-2025-08-07
    api_key_id: APIKEY_52609F
    role: You are a helpful assistant that provides structured data.

nodes:
  - id: start
    type: start

  - id: test_structured
    type: person_job
    label: Test Structured Output
    person: assistant
    max_iteration: 1
    prompt: |
      Create a simple user profile with the following information:
      - name: John Doe
      - age: 30
      - email: john@example.com
    text_format: |
      from pydantic import BaseModel
      from typing import Optional
      from dipeo.core.type_defs import JsonDict
      
      class UserProfile(BaseModel):
          name: str
          age: int
          email: str
          metadata: Optional[JsonDict] = None
      
      class Response(BaseModel):
          user: UserProfile
          success: bool

  - id: endpoint
    type: endpoint

arrows:
  - from: start/output
    to: test_structured/input

  - from: test_structured/output
    to: endpoint/input