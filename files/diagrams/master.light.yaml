version: light
nodes:
  - label: Start
    type: start
    position: {x: 100, y: 200}
    props:
      trigger_mode: manual
      custom_data:
        mode: full  # full | models | nodes
        node_spec_path: ""  # Optional: specific node spec for nodes mode
        
  - label: Prepare Context
    type: code_job
    position: {x: 300, y: 200}
    props:
      code_type: python
      code: files/codegen/code/phase3/master_helpers.py
      functionName: prepare_execution_context
      
  - label: Route by Mode
    type: condition
    position: {x: 500, y: 200}
    props:
      condition_type: custom
      expression: inputs.should_run_models === true
      
  - label: Domain Model Codegen
    type: sub_diagram
    position: {x: 800, y: 100}
    props:
      diagram_name: codegen/domain_models
      input_mapping:
        execution_id: inputs.execution_id
        output_dir: inputs.output_dir
      wait_for_completion: true
      timeout: 60
      
  - label: Check Node Mode
    type: condition
    position: {x: 500, y: 350}
    props:
      condition_type: custom
      expression: inputs.should_run_nodes === true
      
  - label: Node UI Codegen
    type: sub_diagram
    position: {x: 800, y: 350}
    props:
      diagram_name: codegen/node_ui_codegen
      input_mapping:
        node_spec_path: inputs.node_spec_path
        execution_id: inputs.execution_id
        output_dir: inputs.output_dir
      wait_for_completion: true
      timeout: 60
      
  - label: Wait for Completion
    type: code_job
    position: {x: 1100, y: 225}
    props:
      code_type: python
      code: files/codegen/code/phase3/wait_helper.py
      functionName: wait_for_completion
        
  - label: Read Results
    type: code_job
    position: {x: 1300, y: 225}
    props:
      code_type: python
      code: files/codegen/code/phase3/master_helpers.py
      functionName: read_sub_diagram_results
      
  - label: Generate Report
    type: code_job
    position: {x: 1500, y: 225}
    props:
      code_type: python
      code: files/codegen/code/phase3/master_helpers.py
      functionName: generate_final_report
      
  - label: Save Report
    type: code_job
    position: {x: 1700, y: 225}
    props:
      code_type: python
      code: files/codegen/code/phase3/master_helpers.py
      functionName: save_final_report
      
  - label: End
    type: endpoint
    position: {x: 1900, y: 225}
    props:
      save_to_file: true
      file_name: logs/codegen/master_codegen.log

connections:
  - from: Start
    to: Prepare Context
    content_type: object
    
  - from: Prepare Context
    to: Route by Mode
    content_type: object
    
  - from: Prepare Context
    to: Check Node Mode
    content_type: object
    
  - from: Route by Mode_condtrue
    to: Domain Model Codegen
    content_type: object
    
  - from: Check Node Mode_condtrue
    to: Node UI Codegen
    content_type: object
    
  - from: Domain Model Codegen
    to: Wait for Completion
    content_type: object
    
  - from: Node UI Codegen
    to: Wait for Completion
    content_type: object
    
  - from: Route by Mode_condfalse
    to: Wait for Completion
    content_type: object
    
  - from: Check Node Mode_condfalse
    to: Wait for Completion
    content_type: object
    
  - from: Wait for Completion
    to: Read Results
    content_type: object
    
  - from: Read Results
    to: Generate Report
    content_type: object
    
  - from: Generate Report
    to: Save Report
    content_type: object
    
  - from: Save Report
    to: End
    content_type: raw_text