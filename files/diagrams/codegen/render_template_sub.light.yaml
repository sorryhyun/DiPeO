version: light
nodes:
  - label: Start
    type: start
    position: {x: 100, y: 200}
    props:
      trigger_mode: manual
      custom_data:
        template_config: {}  # Template configuration from manifest
        context: {}         # Data context for rendering
        
  - label: Check Runner Type
    type: condition
    position: {x: 300, y: 200}
    props:
      condition_type: custom
      expression: inputs.template_config.runner === 'python_function'
      
  - label: Render Template
    type: template_job
    position: {x: 500, y: 100}
    props:
      template_path: "{{template_config.template}}"
      engine: "{{template_config.engine}}"
      variables: "{{context}}"
      
  - label: Execute Function
    type: code_job
    position: {x: 500, y: 300}
    props:
      functionName: "{{template_config.function}}"
      code_type: python
      code: "{{template_config.module}}"
      
  - label: Apply Post Processing
    type: code_job
    position: {x: 700, y: 200}
    props:
      functionName: apply_post_processors
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Hash Content
    type: code_job
    position: {x: 900, y: 200}
    props:
      functionName: compute_content_hash
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Check Cache
    type: code_job
    position: {x: 1100, y: 200}
    props:
      functionName: check_write_cache
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Write File Atomic
    type: code_job
    position: {x: 1300, y: 100}
    props:
      functionName: write_file_atomic
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Format Code
    type: code_job
    position: {x: 1500, y: 100}
    props:
      functionName: format_generated_code
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Skip Write
    type: code_job
    position: {x: 1300, y: 300}
    props:
      functionName: log_cache_hit
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: Collect Result
    type: code_job
    position: {x: 1700, y: 200}
    props:
      functionName: collect_render_result
      code_type: python
      code: files/codegen/code/phase2/render_template_helpers.py
            
  - label: End
    type: endpoint
    position: {x: 1900, y: 200}
    props:
      save_to_file: false

connections:
  - from: Start
    to: Check Runner Type
    content_type: object
    
  - from: Check Runner Type
    to: Render Template
    label: condfalse
    content_type: object
    
  - from: Check Runner Type
    to: Execute Function
    label: condtrue
    content_type: object
    
  - from: Render Template
    to: Apply Post Processing
    content_type: raw_text
    label: rendered_content
    
  - from: Execute Function
    to: Apply Post Processing
    content_type: raw_text
    label: rendered_content
    
  - from: Start
    to: Apply Post Processing
    content_type: object
    label: template_config
    
  - from: Apply Post Processing
    to: Hash Content
    content_type: object
    
  - from: Hash Content
    to: Check Cache
    content_type: object
    
  - from: Start
    to: Check Cache
    content_type: object
    label: output_path
    
  - from: Check Cache
    to: Write File Atomic
    label: should_write
    content_type: object
    
  - from: Apply Post Processing
    to: Write File Atomic
    content_type: object
    label: processed_content
    
  - from: Start
    to: Write File Atomic
    content_type: object
    label: output_path
    
  - from: Write File Atomic
    to: Format Code
    content_type: object
    
  - from: Start
    to: Format Code
    content_type: object
    label: template_config
    
  - from: Check Cache
    to: Skip Write
    label: "!should_write"
    content_type: object
    
  - from: Format Code
    to: Collect Result
    content_type: object
    
  - from: Skip Write
    to: Collect Result
    content_type: object
    
  - from: Hash Content
    to: Collect Result
    content_type: object
    
  - from: Start
    to: Collect Result
    content_type: object
    
  - from: Collect Result
    to: End
    content_type: object