version: light
nodes:
- label: Start
  type: start
  position: {x: 100, y: 200}
  props:
    trigger_mode: manual
    custom_data:
      spec_file: files/specifications/nodes/example_hook.json
    output_data_structure:
      spec_file: string

- label: Validate Spec
  type: json_schema_validator
  position: {x: 300, y: 200}
  props:
    schema_path: files/schemas/node_specification.schema.json
    data_path: files/specifications/nodes/example_hook.json
    strict_mode: true

- label: Generate Field Config
  type: template_job
  position: {x: 500, y: 200}
  props:
    template_content: |
      // Generated field configuration for {{nodeType}}
      export const {{nodeType}}Fields = [{{#each fields}}
        {
          name: '{{this.name}}',
          type: '{{this.type}}',
          required: {{this.required}},
          defaultValue: '{{this.defaultValue}}'
        }{{#unless @last}},{{/unless}}{{/each}}
      ];
    output_path: output/test_field_config.ts
    variables:
      nodeType: hook
      fields:
        - name: hook_type
          type: enum
          required: true
          defaultValue: shell
        - name: command
          type: string
          required: false
          defaultValue: ""

- label: Report Success
  type: person_job
  position: {x: 700, y: 200}
  props:
    person: Person 1
    first_only_prompt: |
      Code generation test completed successfully!
      Template job generated a field configuration file.
    max_iteration: 1

connections:
- from: Start
  to: Validate Spec
  content_type: raw_text
- from: Validate Spec
  to: Generate Field Config
  content_type: object
- from: Generate Field Config
  to: Report Success
  content_type: raw_text

persons:
  Person 1:
    service: openai
    model: gpt-4.1-nano
    api_key_id: APIKEY_52609F