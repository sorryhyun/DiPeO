{
  "nodes": [
    {
      "id": "node_0",
      "type": "start",
      "position": {
        "x": 50,
        "y": 200
      },
      "data": {
        "custom_data": {},
        "output_data_structure": {},
        "label": "start"
      }
    },
    {
      "id": "node_1",
      "type": "code_job",
      "position": {
        "x": 200,
        "y": 200
      },
      "data": {
        "language": "python",
        "code": "import os\nimport glob\n\n# Define base paths for TypeScript models\nbase_dir = os.environ.get('DIPEO_BASE_DIR', '/home/soryhyun/DiPeO')\nmodels_dir = os.path.join(base_dir, 'dipeo/models/src')\n\n# Gather TypeScript files from main dir and subdirectories\nts_files = []\n\n# Main directory files\nts_files.extend(glob.glob(os.path.join(models_dir, '*.ts')))\n\n# Core files\nts_files.extend(glob.glob(os.path.join(models_dir, 'core', '*.ts')))\nts_files.extend(glob.glob(os.path.join(models_dir, 'core', 'nodes', '*.ts')))\nts_files.extend(glob.glob(os.path.join(models_dir, 'core', 'enums', '*.ts')))\n\n# Specifications files\nts_files.extend(glob.glob(os.path.join(models_dir, 'specifications', '*.ts')))\nts_files.extend(glob.glob(os.path.join(models_dir, 'specifications', 'nodes', '*.ts')))\n\n# Utilities files\nts_files.extend(glob.glob(os.path.join(models_dir, 'utilities', '*.ts')))\n\n# Codegen files\nts_files.extend(glob.glob(os.path.join(models_dir, 'codegen', '*.ts')))\n\n# Frontend files\nts_files.extend(glob.glob(os.path.join(models_dir, 'frontend', '*.ts')))\nts_files.extend(glob.glob(os.path.join(models_dir, 'frontend', 'query-definitions', '*.ts')))\n\nprint(f\"Found {len(ts_files)} TypeScript files to parse\")\n\nresult = {\n    'file_paths': ts_files\n}\n",
        "label": "gather typescript files"
      }
    },
    {
      "id": "node_2",
      "type": "code_job",
      "position": {
        "x": 400,
        "y": 200
      },
      "data": {
        "language": "python",
        "code": "import os\n\nfile_paths = inputs.get('default', {}).get('file_paths', [])\nsources = {}\nfor file_path in file_paths:\n    try:\n        with open(file_path, 'r', encoding='utf-8') as f:\n            content = f.read()\n            # Use file path as key for tracking\n            sources[file_path] = content\n    except Exception as e:\n        print(f\"Warning: Failed to read {file_path}: {e}\")\n        continue\n\nprint(f\"Successfully read {len(sources)} TypeScript files\")\nresult = {'sources':sources}\n",
        "label": "read all sources"
      }
    },
    {
      "id": "node_3",
      "type": "typescript_ast",
      "position": {
        "x": 600,
        "y": 200
      },
      "data": {
        "batch": true,
        "batchInputKey": "sources",
        "includeJSDoc": true,
        "parseMode": "module",
        "outputFormat": "for_codegen",
        "extractPatterns": [
          "interface",
          "type",
          "enum",
          "const"
        ],
        "label": "batch parse typescript"
      }
    },
    {
      "id": "node_4",
      "type": "code_job",
      "position": {
        "x": 800,
        "y": 200
      },
      "data": {
        "language": "python",
        "code": "import os\nimport json\n\n# Get batch results\nbatch_results = inputs.get('default', {})\nif not isinstance(batch_results, dict):\n    print(\"Warning: No batch results to cache\")\n    result = {'cached_count': 0}\nelse:\n    base_dir = os.environ.get('DIPEO_BASE_DIR', '/home/soryhyun/DiPeO')\n    models_dir = os.path.join(base_dir, 'dipeo/models/src')\n    \n    cached_count = 0\n    for file_path, parse_result in batch_results.items():\n        # Get relative path from models_dir\n        if file_path.startswith(models_dir):\n            relative_path = os.path.relpath(file_path, models_dir)\n        else:\n            # Fallback to basename if not in expected location\n            relative_path = os.path.basename(file_path)\n        \n        # Create cache path preserving directory structure\n        cache_path = f'temp/{relative_path}.json'\n        cache_dir = os.path.dirname(cache_path)\n        \n        # Ensure cache directory exists\n        if cache_dir and cache_dir != 'temp':\n            os.makedirs(cache_dir, exist_ok=True)\n        \n        # Save the parsed result to cache\n        try:\n            with open(cache_path, 'w', encoding='utf-8') as f:\n                json.dump(parse_result, f, indent=2)\n            cached_count += 1\n        except Exception as e:\n            print(f\"Warning: Failed to cache {file_path}: {e}\")\n    \n    print(f\"Successfully cached {cached_count} parsed TypeScript files\")\n    result = {'cached_count': cached_count}\n",
        "label": "save cache files"
      }
    },
    {
      "id": "node_5",
      "type": "endpoint",
      "position": {
        "x": 1000,
        "y": 200
      },
      "data": {
        "save_to_file": false,
        "label": "end"
      }
    }
  ],
  "arrows": [
    {
      "id": "arrow_0",
      "source": "node_0_default_output",
      "target": "node_1_default_input",
      "label": null,
      "data": null,
      "content_type": "raw_text"
    },
    {
      "id": "arrow_1",
      "source": "node_1_default_output",
      "target": "node_2_default_input",
      "label": null,
      "data": null,
      "content_type": "object"
    },
    {
      "id": "arrow_2",
      "source": "node_2_default_output",
      "target": "node_3_default_input",
      "label": null,
      "data": null,
      "content_type": "object"
    },
    {
      "id": "arrow_3",
      "source": "node_3_default_output",
      "target": "node_4_default_input",
      "label": null,
      "data": null,
      "content_type": "object"
    },
    {
      "id": "arrow_4",
      "source": "node_4_default_output",
      "target": "node_5_default_input",
      "label": null,
      "data": null,
      "content_type": "raw_text"
    }
  ],
  "persons": [],
  "handles": [
    {
      "id": "node_0_default_output",
      "node_id": "node_0",
      "label": "default",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_1_default_input",
      "node_id": "node_1",
      "label": "default",
      "direction": "input",
      "data_type": "any",
      "position": "left"
    },
    {
      "id": "node_1_default_output",
      "node_id": "node_1",
      "label": "default",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_2_default_input",
      "node_id": "node_2",
      "label": "default",
      "direction": "input",
      "data_type": "any",
      "position": "left"
    },
    {
      "id": "node_2_default_output",
      "node_id": "node_2",
      "label": "default",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_3_default_input",
      "node_id": "node_3",
      "label": "default",
      "direction": "input",
      "data_type": "any",
      "position": "left"
    },
    {
      "id": "node_3_default_output",
      "node_id": "node_3",
      "label": "default",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_4_default_input",
      "node_id": "node_4",
      "label": "default",
      "direction": "input",
      "data_type": "any",
      "position": "left"
    },
    {
      "id": "node_4_default_output",
      "node_id": "node_4",
      "label": "default",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_5_default_input",
      "node_id": "node_5",
      "label": "default",
      "direction": "input",
      "data_type": "any",
      "position": "left"
    },
    {
      "id": "node_3_results_output",
      "node_id": "node_3",
      "label": "results",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    },
    {
      "id": "node_3_error_output",
      "node_id": "node_3",
      "label": "error",
      "direction": "output",
      "data_type": "any",
      "position": "right"
    }
  ],
  "metadata": {
    "name": "Untitled",
    "description": null,
    "author": null,
    "tags": null,
    "created": "2025-08-13T06:34:21.286Z",
    "modified": "2025-08-13T06:34:21.286Z",
    "version": "1.0.0",
    "id": null
  }
}