# Unified Code Generation Pipeline
# Generates all code from TypeScript sources - both domain models and node UI

version: light

nodes:
  - label: Start
    type: start
    position: {x: 50, y: 300}
    props:
      custom_data:
        message: Starting unified code generation from TypeScript sources

  # Phase 1: Domain Model Generation (replacement for legacy make codegen)
  - label: Generate All Domain Models
    type: sub_diagram
    position: {x: 250, y: 350}
    props:
      diagram_name: codegen/diagrams/models/generate_all_models
      diagram_format: light

  # Phase 2: Node UI Generation from TypeScript specifications
  - label: Generate Backend Node Files
    type: sub_diagram
    position: {x: 550, y: 250}
    props:
      diagram_name: codegen/diagrams/backend/generate_backend_batch_ts
      diagram_format: light

  - label: Generate Frontend Node Files
    type: sub_diagram
    position: {x: 550, y: 450}
    props:
      diagram_name: codegen/diagrams/frontend/generate_frontend_batch_ts
      diagram_format: light


  # Summary
  - label: Summarize Results
    type: code_job
    position: {x: 850, y: 350}
    props:
      language: python
      code: |
        print("\n=== Unified Code Generation Complete ===")
        print("\nPhase 1 - Domain Models:")
        print("✓ All domain models generated from TypeScript sources")
        
        print("\nPhase 2 - Node UI:")
        print("✓ Backend node files generated from TypeScript specs")
        print("✓ Frontend node files generated from TypeScript specs")
        print("✓ Node registry generated (included in frontend batch)")
        
        result = {
            'status': 'success',
            'message': 'All code generation completed successfully'
        }

  - label: End
    type: endpoint
    position: {x: 1050, y: 350}
    props:
      save_to_file: false

connections:
  # Phase 1 - Domain model generation
  - from: Start
    to: Generate All Domain Models
  
  # Wait for domain models before generating node UI
  - from: Generate All Domain Models
    to: Generate Backend Node Files
  
  # Frontend can start after domain models are ready
  - from: Generate All Domain Models
    to: Generate Frontend Node Files
  
  # Summary waits for everything
  - from: Generate All Domain Models
    to: Summarize Results
  - from: Generate Backend Node Files
    to: Summarize Results
  - from: Generate Frontend Node Files
    to: Summarize Results
  
  - from: Summarize Results
    to: End