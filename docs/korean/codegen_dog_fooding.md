
# DiPeO의 코드 생성 시스템 도그푸딩

## DiPeO 개요

**DiPeO** (*daɪpiːɔː*로 발음)는 직관적인 시각적 프로그래밍 환경을 통해 사용자가 에이전트 기반 워크플로우를 구축, 실행, 모니터링할 수 있게 하는 모노레포입니다.

* **프론트엔드:** 기능 기반 React UI
* **백엔드:** 도메인 주도 FastAPI
* **CLI 도구:** 대규모 자동화용 (멀티 LLM, 실시간)
* **주요 기능:**

  * 향상된 컨텍스트 관리를 위한 LLM 에이전트와 작업 블록의 직관적 분리
  * 다이어그램의 YAML 기반 표현 + 실행 도구
  * *A2A* (에이전트 대 에이전트) 캔버스 계획
  * 로컬 실행: 개인정보 보호를 위해 모든 작업이 사용자의 컴퓨터에서 실행
  * 빠른 설치 및 실행: `make` 명령으로 프론트엔드/백엔드 시작

---

## 동기와 철학

* DiPeO는 **기존의 다이어그램 기반 에이전트 도구가 개발자들에게 직관적이지 않다**는 관찰 후에 만들어졌습니다.
* 어려움에는 다음이 포함되었습니다:

  * 컨텍스트, 메모리, 샌드박싱 이해
  * 다이어그램에서 루프, 조건문, 에이전트 작업 구분
* **"사람"으로서의 LLM 에이전트**:

  * 각 LLM 인스턴스는 지속적인 메모리를 가진 "사람"
  * 작업 간에 메모리가 유지됨
  * 에이전트는 글로벌 메모리를 공유하지만 선택적으로 일부를 잊을 수 있음 (에이전트별 정책)
* **명시적 다이어그램:**

  * 루프와 조건이 명시적으로 표현됨 (예: `first_only`, 최대 반복 횟수, 조건 블록)
  * 캔버스는 샌드박스 공간으로 작동; 다이어그램은 에이전트 간 네트워크를 형성할 수 있음
  * 대화는 전역적으로 저장되며, 메모리는 정책에 의해 관리됨 (예: `no_forget`, `on_every_turn`)

---

## 메모리 시스템 설계

* **글로벌 대화 모델:** 모든 에이전트의 모든 메시지가 단일, 불변, 공유 대화에 저장됨
* **메모리 뷰:** 에이전트는 필터를 통해 대화를 봄:

  * `ALL_INVOLVED`, `SENT_BY_ME`, `SENT_TO_ME`, `SYSTEM_AND_ME`, `CONVERSATION_PAIRS`
* **슬라이딩 윈도우:** 메시지 제한 (예: 마지막 *n*개 메시지)
* **작업 수준 설정:** 메모리 설정은 사람이 아닌 작업 수준에서 이루어짐

### 메모리 패턴

* **토론:** 에이전트는 현재 교환에 집중하고, 심사위원은 전체 컨텍스트 유지
* **파이프라인:** 단계를 거치며 컨텍스트 감소 (분석 → 요약 → 추출)
* **다중 에이전트 협업:** 서로 다른 에이전트가 대화를 다르게 인식 (연구원, 비평가, 진행자)

**타이밍:**

* `on_every_turn`, `upon_request`, `no_forget`
* 잊기는 비파괴적; 메시지는 삭제되지 않고 숨겨짐

**모범 사례:**

* 각 작업에 적합한 메모리 뷰 선택
* 합리적인 메시지 제한 설정
* 전체에서 최소 컨텍스트로 메모리 흐름 설계
* 항상 시스템 프롬프트 보존

---

## 다이어그램 형식과 노드 유형

DiPeO 다이어그램은 다음과 같이 표현될 수 있습니다:

1. **domain JSON:** 정식, 영구적, 전체 구조/레이아웃 데이터
2. **light YAML:** 가독성을 위해 단순화, 위치 반올림, ID 제거
3. **readable YAML:** 워크플로우 이해에 최적화; 흐름을 라인으로, 정의 분리

**노드 유형:**

* `start`: 진입점, 트리거 모드 포함
* `person_job`: 사람을 위한 LLM 기반 작업; 프롬프트, 반복, 메모리 프로필 지원 (FULL, FOCUSED, MINIMAL, GOLDFISH)
* `condition`: 분기 로직, 모든 작업이나 사용자 정의 표현식에서 트리거 가능
* `code_job`: 코드 실행 (Python, TypeScript, Bash, Shell) 인라인 또는 파일에서
* `endpoint`: 결과를 파일로 저장 (텍스트, JSON, YAML)
* `db`: 파일이나 데이터베이스에서 읽기
* `api_job`: HTTP 요청 수행
* `user_response`: 사용자 입력 캡처

**메모리 프로필:**

* **FULL:** 모든 메시지
* **FOCUSED:** 마지막 20개 쌍
* **MINIMAL:** 시스템 + 마지막 5개 메시지
* **GOLDFISH:** 마지막 2개 메시지만 (시스템 보존 없음)

*한국어 라이트 가이드도 사용 가능*.

---

## 최첨단 코드 생성 및 메타 코딩 기능

### 자동 GraphQL 타입 생성

* 생성기가 `domain-schema.graphql`에서 직접 Strawberry GraphQL 타입 생성
* 보일러플레이트 감소 (~70%), 일관성 강화
* TypeScript 모델 → GraphQL 스키마 → Strawberry 타입 변환
* `dipeo run` 또는 `make codegen`을 통해 트리거
* 타입이 서버에 자동으로 임포트됨
* 셀프 호스팅 증명: DiPeO는 자체 실행 엔진을 사용하여 API 레이어 구축

### 다중 언어 모델 생성

* 시스템이 TypeScript AST를 소비하고 Python Pydantic 모델 및 기타 아티팩트 생성
* 사용자 정의 Jinja2 필터:

  * snake/camel/pascal 변환
  * 복수형 처리
  * 타입 변환 (예: `str` ↔ `string`)
  * 기본값 매핑
* 템플릿 환경이 문자열에서 템플릿을 로드하고 필터 등록
* `python_models.py` 생성기:

  * 선택적 타입, 배열, 맵, 유니온, 브랜드 ID 처리
  * 매핑이 노드→UI 필드, Zod 스키마, Pydantic 기본값 정의
* 결과: **단일 진실의 소스** (TS 정의) - 백엔드(Pydantic), 프론트엔드(React), API 타입 전반

### 다이어그램 기반 코드젠을 통한 도그푸딩

* 코드 생성이 다이어그램을 통해 오케스트레이션됨
* `run_codegen.py`가 임시 다이어그램을 생성하고 DiPeO CLI를 통해 실행 (`dipeo run <diagram>`)
* DiPeO의 시각적 엔진이 새로운 노드/UI를 위한 코드 생성—실제 *도그푸딩*

### 확장 가능한 노드 사양

* 노드 동작이 TypeScript 사양에 정의됨: 필드, UI 설정, 실행, 예제
* 예: 서브 다이어그램 노드 사양이 다이어그램 선택, I/O 매핑, 타임아웃, 컨텍스트 옵션 정의
* 사양이 코드젠 시스템 구동: 백엔드 모델, GraphQL 타입, 프론트엔드 폼 자동 생성
* UI 메타데이터가 일관성과 확장성 보장

---

## 강점과 고유한 가치

* **직관적인 메모리/컨텍스트 관리:** 각 LLM은 지속적인 메모리를 가진 사람; 글로벌 대화 모델 + 에이전트별 뷰 = 세밀한 제어
* **YAML 왕복 변환이 가능한 시각적 프로그래밍:** 다이어그램을 JSON/YAML로 내보내기/가져오기; 코드 편집기에서 편집; 빠른 편집을 위한 라이트 YAML, 완전한 충실도를 위한 도메인 JSON
* **셀프 호스팅 작업 및 프라이버시:** 모든 처리가 로컬, 외부 서버 없음
* **도그푸딩 메타 코드젠:** 플랫폼이 코드젠을 위해 자체를 사용—견고성, 수동 작업 감소
* **크로스 언어 일관성:** Python 타입, Zod 스키마, UI를 위한 단일 진실의 소스로서의 TS 모델
* **유연한 에이전트 협업:** 복잡한 워크플로우를 위한 토론, 파이프라인, 다중 에이전트 패턴
* **확장 가능한 노드 시스템:** UI 메타데이터와 실행 규칙이 있는 노드 사양 → 다이어그램을 통한 새로운 노드

---

## 결론

> **DiPeO**는 단순한 다이어그램 편집기 그 이상입니다.
> 시각적 프로그래밍, 견고한 메모리 관리, 자동화된 코드 생성을 통합하는 풀스택 플랫폼입니다. LLM을 글로벌 대화와 에이전트별 필터를 가진 지속적인 "사람"으로 모델링함으로써, DiPeO는 개발자들이 복잡한 다중 에이전트 워크플로우를 *직관적으로* 설계할 수 있게 합니다. 다이어그램이 Pydantic 모델과 GraphQL 타입을 생성하는 도그푸딩 접근 방식은 미래 지향적인 메타 코딩 패러다임을 보여줍니다. 프라이버시를 보호하는 로컬 실행, 크로스 언어 코드젠, 유연한 패턴 추상화로, DiPeO는 AI 기반 에이전트를 구축하고 실험하는 데 있어 돋보입니다.

---